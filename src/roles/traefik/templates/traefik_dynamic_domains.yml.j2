## Traefik domain-specific configuration
## Generated by Ansible - do not edit manually

http:
  routers:
    # Admin interface routers
    {% for domain_item in loaded_domains.results | default([]) %}
    {% set domain_cfg = domain_item.ansible_facts.domain_config %}
    admin-{{ domain_cfg.domain | replace('.', '-') }}:
      rule: "Host(`{{ domain_cfg.admin }}`)"
      service: "admin"
      entryPoints:
        - "websecure"
      tls: {}
      middlewares:
        - "secure-headers@file"
        - "admin-auth@file"
        - "ip-whitelist-admin@file"
    
    # Webmail routers
    webmail-{{ domain_cfg.domain | replace('.', '-') }}:
      rule: "Host(`{{ domain_cfg.webmail }}`)"
      service: "webmail"
      entryPoints:
        - "websecure"
      tls: {}
      middlewares:
        - "secure-headers@file"
        - "gzip@file"
    
    # Autoconfig for mail clients
    autoconfig-{{ domain_cfg.domain | replace('.', '-') }}:
      rule: "Host(`autoconfig.{{ domain_cfg.domain }}`)"
      service: "autoconfig"
      entryPoints:
        - "websecure"
      tls: {}
    {% endfor %}
    
  services:
    # Map services to Mailu containers
    admin:
      loadBalancer:
        servers:
          - url: "http://localhost:8080/"
    webmail:
      loadBalancer:
        servers:
          - url: "http://localhost:8080/webmail/"
    autoconfig:
      loadBalancer:
        servers:
          - url: "http://localhost:8080/autoconfig/"