{% raw %}
# {{ ansible_managed }} - Generated by Ansible

http:
  routers:
    {% for domain_item in loaded_domains.results %}
    {% set domain_cfg = domain_item.ansible_facts.domain_config %}
    # Routers for {{ domain_cfg.domain }}
    router-webmail-{{ domain_cfg.domain | replace('.', '-') }}:
      entryPoints:
        - "websecure"
      rule: "Host(`{{ domain_cfg.webmail }}`)"
      service: "mailu-front"
      tls:
        certResolver: cloudflare
        domains:
          - main: "{{ domain_cfg.webmail }}"

    router-admin-{{ domain_cfg.domain | replace('.', '-') }}:
      entryPoints:
        - "websecure"
      rule: "Host(`{{ domain_cfg.admin }}`)"
      service: "mailu-admin"
      tls:
        certResolver: cloudflare
        domains:
          - main: "{{ domain_cfg.admin }}"
    {% endfor %}

  services:
    mailu-front:
      loadBalancer:
        servers:
          - url: "http://front:80"

    mailu-admin:
      loadBalancer:
        servers:
          - url: "http://admin:80"

tl:
  certificates:
    # Define certificates if needed, but DNS-01 resolver handles it mostly
    # Example:
    # - certFile: /path/to/certs/example.com.crt
    #   keyFile: /path/to/certs/example.com.key

# Provider configuration (if needed, often handled in static config)
# providers:
#   docker:
#     exposedByDefault: false
{% endraw %}